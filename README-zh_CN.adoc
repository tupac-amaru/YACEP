# _YACEP_ : yet another csharp expression parser

_YACEP_ 是一个非常小的表达式解析库 , 它读取字符串并转换成一棵抽象语法树. 同时它能把抽象语法树转换成 `IEvaluator` 对象. `IEvaluator` 对象可以接受表达式需要的参数,并执行表达式.

示例代码

[source,csharp]
----
var state = new
{
    x = 7,
    y = 43.0f,
    z = new Dictionary<string, string>
    {
        ["yacep"] = "yet another csharp expression parser",
        ["tupac-amaru"] = "was the last indigenous monarch (Sapa Inca) of the Neo-Inca State"
    },
    rand = new Func<object>(() => new Random().Next(1, 3)),
    array = Enumerable.Range(1971, 1996 - 1971)
};
var expr = "x + y - z['yacep'].Length + max([1, 2, 3]) + (this.rand() > 2 ? 1971 : 1996) - len(array)";
var evaluator = expr.Compile();
var value = evaluator.EvaluateAs<decimal>(state); 
----

## 特性
- **开箱即用** - 零配置
- **跨平台** - 基于 https://github.com/dotnet/standard/blob/master/docs/versions/netstandard2.0.md[netstandard2.0] 构建
- **非常小** - 核心的转换代码只有500多行
- **低消耗** - 使用了 https://docs.microsoft.com/en-za/dotnet/api/system.readonlyspan-1?view=netcore-2.2[ReadOnlySpan<T> Struct] 来解析字符串
- **快** - 相对于使用反射, _YACEP_ 使用 https://docs.microsoft.com/zh-cn/dotnet/api/system.reflection.emit?view=netstandard-2.0[emit] 用创建动态代理的方式来访问对象公开的方法,属性,字段.
- **自定义一元操作符** - 支持指定任意字符串为一元操作符
- **自定义二元操作符** - 支持指定任意字符串为带 https://en.wikipedia.org/wiki/Order_of_operations#Programming_language[优先级] 二元操作符  
- **自定义字面量** - 支持自定义字面量
- **自定义函数** - 支持自定义函数
- **内置三目运算符** - 就和C#中的 https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/conditional-operator[?:] 一样
- **内置in操作符** - 查看一个对象是否在一个序列中
- **索引器** - 支持使用索引器来访问对象的方法，属性，字段等，对于字典数组等原生支持使用索引器访问元素

 

## 表达式值类型 - 直接从字符串中读取的值

**重要!!!** 在 _YACEP_ 中是没有带符号数字的,因为符号 `-` 可以被重定义为其他意义. 但是为了方便广大C#开发者的使用习惯,内部会按照值的大小在读取的时候动态转换类型. 如果一个整数大于 https://docs.microsoft.com/en-us/dotnet/api/system.uint32.maxvalue?view=netstandard-2.0[4294967295] 会被读取为 `ulong` 类型,如果还大于 https://docs.microsoft.com/en-us/dotnet/api/system.int32.maxvalue?view=netstandard-2.0[2147483648] 就会被读取为 `integer` 类型,否则就会读取为 `int` 类型.
 
.数据类型 
|=======
|表达式值类型|C#值类型| 描述 

|ulong 
|https://docs.microsoft.com/en-us/dotnet/api/system.uint64?view=netstandard-2.0[UInt64]
|如果一个整数大于 https://docs.microsoft.com/en-us/dotnet/api/system.uint32.maxvalue?view=netstandard-2.0[4294967295] 会被读取为 `ulong` 类型. :point_down:
|integer 
|https://docs.microsoft.com/en-us/dotnet/api/system.uint32?view=netstandard-2.0[UInt32]
|如果还大于 https://docs.microsoft.com/en-us/dotnet/api/system.int32.maxvalue?view=netstandard-2.0[2147483648] 就会被读取为 `integer` 类型 :point_down:
|int 
|https://docs.microsoft.com/en-us/dotnet/api/system.int32?view=netstandard-2.0[Int32]
|小于 https://docs.microsoft.com/en-us/dotnet/api/system.int32.maxvalue?view=netstandard-2.0[2147483648] 的数值
|decimal 
|https://docs.microsoft.com/en-us/dotnet/api/system.decimal?view=netstandard-2.0[Decimal]
| 浮点型数据
|string 
|https://docs.microsoft.com/en-us/dotnet/api/system.string?view=netstandard-2.0[String]
|UTF-16字符串. 单引号和双引号都支持
|array
|https://docs.microsoft.com/en-us/dotnet/api/system.array?view=netstandard-2.0[Object Array]
|Object数组
|literal
|https://docs.microsoft.com/en-us/dotnet/api/system.object?view=netstandard-2.0[Object]
|被设置为映射到其他的值的字面量
|=======



## License
MIT license

